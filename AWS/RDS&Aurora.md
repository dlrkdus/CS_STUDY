## RDS를 쓸까 EC2에 DB를 설치할까?

→ RDS가 더 많은 옵션을 제공함

- 프로비저닝, OS 패치 자동화
- 지속적인 백업과 특정 시점 복원
- 모니터링 대시보드
- 읽기 전용 복제본
- 다중 AZ 설정
- 스케일 인/아웃
- 단, RDS에 SSH로 접근은 불가능

## RDS auto Scaling

스토리지가 부족해지면 스케일 아웃, 최대 스토리지 임계값을 설정해야 함

워크로드를 예측할 수 없는 애플리케이션에 유용

실제 인스턴스 수를 늘리는건 아니고 용량을 자동으로 확장하거나 읽기 복제본을 자동으로 조정하는 수준

## RDS 스냅샷

RDS의 상태를 특정 시점에 캡쳐, 스냅샷으로 복원함

전체 데이터, 스키마, 인덱스, 설정, DB 파라미터, 스토리지 정보 등 저장

## 읽기 복제본

<img width="650" height="460" alt="image" src="https://github.com/user-attachments/assets/9afb6899-68ab-41f6-bd99-b45d5c4284b5" />

- Master는 읽기+쓰기, Slave는 읽기 담당, 이를 통해 읽기 트래픽 분산, 장애 복구 가능
- 읽기 복제본은 최대 15개, 다른 AZ로도 생성 가능, 만약 다른 AZ에 생성된다면 복제 과정에서 네트워크 비용 발생
- 복제는 비동기 방식으로 진행
- 복제본이 마스터로 승격될 수 있음(수동)

## Multi AZ(DR)

<img width="650" height="460" alt="image" src="https://github.com/user-attachments/assets/6db02f9c-3908-440e-9483-e6be72efa5db" />

읽기 복제본이 아닌 장애 복구를 위한 StandBy 복제본, 모든 트래픽은 Master가 받는다.

이 경우는 복제가 동기식으로 이뤄지고, 따라서 비동기 복제 방식인 읽기 복제본보다 일관성이 강하다.

또한 장애 시 자동으로 승격되기 때문에 고가용성에 더 강하다. (다운타임이 없음)

1. RDS가 자동으로 스냅샷 생성
2. 스냅샷에서 새로운 DB가 새로운 AZ에 복원
3. 동기화 설정됨

## Aurora

AWS 고유 기술로 오픈 소스 아님, PostgreSQL과 MySQL 지원

AWS에 특화돼있으며 RDS-MySQL에 비해 5배, RDS-PsotgreSQL에 비해선 3배 높은 성능

RDS에 비해 20% 가격 높지만 복제와 페일오버가 빠름

특징 → 자동 failover, 백업 및 복구, 버튼 한 번으로 확장 가능, 제로 다운타임, 자동 패치, 백트랙 등

### 고가용성과 읽기 확장성

<img width="430" height="350" alt="image" src="https://github.com/user-attachments/assets/968bfc60-a580-41a4-a45e-a4e7dafef151" />

- 3개의 AZ에 6개의 복사본 저장, AZ 하나쯤은 작동 안해도 괜찮음
- 쓰기에는 6개 중 4개만, 읽기에는 3개만 있어도 됨 → 읽기 가용성이 높다
- P2P 복제를 통한 자가 복구, 스토리지 복제는 준동기, 리더 노드 복제는 비동기
- 단일 볼륨 아닌 수백 개 볼륨
- 크로스 리전 복제 지원

### Aurora DB Cluster

<img width="1000" height="460" alt="image" src="https://github.com/user-attachments/assets/5e0a3ff5-2f26-4db7-8503-fe4f8b486eea" />

1개의 Primary 노드와 0개 이상의 Replica(Aurora는 보통 5개)로 구성된 데이터베이스 클러스터

Reader EndPoint가 읽기 요청을 분산한다. 자동 스케일링, 자동 확장을 지원함

요청(쿼리)별 분산이 아니라 **Connection 단위 분산**이다.

### Custom endpoint

<img width="1000" height="360" alt="image" src="https://github.com/user-attachments/assets/46f2c26e-f6a3-4d99-8201-b6623496d893" />

일부 엔드포인트를 사용자 지정 엔드포인트로 정의할 수 있음 (ex. 특정 복사본에서는 분석 쿼리 실행)

이를 활성화하면 Reader 엔드포인트는 사용되지 않음

### Multi Master

읽기에서 고가용성을 갖지만 쓰기에서도 고가용성을 갖추려면 Aurora 클러스터의 모든 노드에서 읽기 및 쓰기를 수행하면 된다.

### Aurora Database Cloning

기존 데이터베이스로부터 새로운 클러스터 생성, 스냅샷 및 복원보다 빠름

프로덕션 데이터베이스에 영향을 주지 않고 스테이징 데이터베이스를 생성하는 데 유용

### Global Aurora

- 읽기 복제본을 다른 리전에 둘 수 있다. 기본적으로는 하나지만, 최대 5개의 읽기 전용 리전을 둘 수 있으며 복제 지연은 1초 미만이다. 각 보조 리전 당 최대 16개의 복사본 생성 가능
- 다른 리전에서 승격할 때는(RTO) 1분 미만

## RDS 백업

자동 백업 : 매일 DB 전체 백업(S3에, AWS만 관리하며 사용자는 접근 불가능), 5분마다 트랜잭션 로그(모든 변경 작업) 백업, 1-35일동안 저장

수동 스냅샷 : 사용자가 수동으로 트리거

중지된 RDS에서도 비용이 나가므로 오래 중지할거면 스냅샷을 뜬 뒤 DB는 삭제하는 것이 좋음

### Aurora 백업

자동 백업이 기본이며 비활성화 불가능

수동 스냅샷은 RDS와 동일

## RDS 복원

백업 또는 스냅샷으로 DB 복원 가능

백업이 더 세밀함 → 특정 시점 복원, 트랜잭션 로그 저장, 그러나 느림

스냅샷은 더 빠르고 다른 리전에서도 복원 가능하다

복원은 S3에 저장된 백업/스냅샷 파일로 복원한다.

## RDS&Aurora Security

AWS KMS로 암호화, 마스터가 암호화되지 않으면 읽기 복제본도 암호화 불가능

암호화되지 않은 기존 DB를 암호화하려면 스냅샷을 통해 암호화된 DB로 생성해야 함

TLS, IAM, 보안 그룹, 감사 로그 가능, SSH 불가능

## RDS Proxy(서버리스에서 필수)

RDS와 애플리케이션 사이의 커넥션 풀, 커넥션 풀을 사용할 수 없는 애플리케이션(서버리스 등)에서 사용

즉, 애플리케이션은 RDS에 연결하는 것이 아닌 프록시에 연결하고, 프록시는 연결을 모아서 RDS로 연결함

RDS Proxy도 서버리스로 오토 스케일링과 다중 AZ가 가능함. RDS와 Aurora의 장애 조치 시간을 66% 감소

퍼블릭 액세스 절대 불가능
